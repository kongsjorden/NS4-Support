---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import FeatureCard from '../components/FeatureCard.astro';
import PhoneMockup from '../components/PhoneMockup.astro';

const features = [
  {
    title: 'Setlist Management',
    description: 'Create unlimited setlists with songs, program selections, BPM, and performance notes.',
    icon: 'setlist',
  },
  {
    title: 'Performance Mode',
    description: 'Full-screen stage-ready interface with large touch zones for seamless song navigation.',
    icon: 'performance',
  },
  {
    title: 'Master Click',
    description: 'Per-song metronome with auto-start, MIDI clock sync, and multiple time signatures.',
    icon: 'metronome',
  },
  {
    title: 'Extended MIDI Controls',
    description: 'Organ drawbars, synth filters, effects, and a versatile Morph Pad for expressive control.',
    icon: 'midi',
  },
];
---

<Layout title="Home">
  <!-- Hero Section -->
  <Hero
    title="Your Stage Keyboard, Supercharged"
    subtitle="Create setlists, control MIDI parameters, and perform with confidence. The companion app that fills the gaps."
  />

  <!-- App Showcase Section -->
  <section class="py-16 md:py-24 relative overflow-hidden">
    <!-- Background -->
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-surface/50 to-transparent pointer-events-none"></div>

    <div class="max-w-7xl mx-auto px-6 relative">
      <div class="text-center mb-16">
        <h2 class="font-display font-bold text-3xl md:text-4xl lg:text-5xl text-text mb-4">
          Designed for the Stage
        </h2>
        <p class="text-text-muted text-lg max-w-2xl mx-auto">
          A dark, focused interface that's easy on the eyes under any lighting condition
        </p>
      </div>

      <!-- Screenshot Carousel -->
      <div class="relative group/carousel">
        <!-- Fade edges -->
        <div class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-bg to-transparent z-10 pointer-events-none"></div>
        <div class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-bg to-transparent z-10 pointer-events-none"></div>

        <!-- Navigation Arrows (Desktop) -->
        <button
          id="carousel-prev"
          class="absolute left-2 md:left-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full bg-surface/90 backdrop-blur border border-border/50 text-text-muted hover:text-primary hover:border-primary/50 hover:bg-surface transition-all duration-300 opacity-0 group-hover/carousel:opacity-100 focus:opacity-100 hidden md:flex items-center justify-center shadow-lg hover:scale-110"
          aria-label="Previous screenshot"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <button
          id="carousel-next"
          class="absolute right-2 md:right-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full bg-surface/90 backdrop-blur border border-border/50 text-text-muted hover:text-primary hover:border-primary/50 hover:bg-surface transition-all duration-300 opacity-0 group-hover/carousel:opacity-100 focus:opacity-100 hidden md:flex items-center justify-center shadow-lg hover:scale-110"
          aria-label="Next screenshot"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>

        <div class="flex gap-6 md:gap-8 overflow-x-auto pb-8 px-4 scrollbar-hide snap-x snap-mandatory scroll-smooth cursor-grab active:cursor-grabbing" id="screenshot-carousel">
          <!-- Setlist with song -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="0">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/setlist-song.png" alt="Setlist with songs" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Setlist View</p>
            </div>
          </div>

          <!-- Performance Mode -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="1">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/performance-mode.png" alt="Performance mode" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Performance Mode</p>
            </div>
          </div>

          <!-- Programs Browser -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="2">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/programs-browser.png" alt="Programs browser" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Programs Browser</p>
            </div>
          </div>

          <!-- Tempo/Metronome -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="3">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/tempo-metronome.png" alt="Tempo and metronome" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Tempo & Click</p>
            </div>
          </div>

          <!-- Tempo Settings / MIDI Clock -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="4">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/tempo-settings.png" alt="MIDI Clock and tempo settings" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">MIDI Clock Settings</p>
            </div>
          </div>

          <!-- Controls Quick -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="5">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/controls-quick.png" alt="Quick controls" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Quick Controls</p>
            </div>
          </div>

          <!-- MIDI Monitor -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="6">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/midi-monitor.png" alt="MIDI monitor" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">MIDI Monitor</p>
            </div>
          </div>

          <!-- Add Song -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="7">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/add-song.png" alt="Add song dialog" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Add Song</p>
            </div>
          </div>

          <!-- Programs Favorites -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="8">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/programs-favorites.png" alt="Favorite programs" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Favorites</p>
            </div>
          </div>

          <!-- Settings -->
          <div class="flex-shrink-0 snap-center carousel-item" data-index="9">
            <div class="relative group">
              <div class="absolute -inset-4 bg-primary/10 rounded-[3rem] opacity-0 group-hover:opacity-100 blur-2xl transition-opacity duration-500"></div>
              <PhoneMockup src="/screenshots/settings.png" alt="App settings" size="md" />
              <p class="text-center text-text-muted text-sm mt-4 font-medium">Settings</p>
            </div>
          </div>
        </div>

        <!-- Dot indicators -->
        <div class="flex justify-center gap-2 mt-6" id="carousel-dots">
          {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => (
            <button
              class="carousel-dot w-2 h-2 rounded-full bg-text-dim/30 hover:bg-text-dim/60 transition-all duration-300 hover:scale-125"
              data-index={i}
              aria-label={`Go to screenshot ${i + 1}`}
            />
          ))}
        </div>

        <!-- Scroll hint (mobile only) -->
        <div class="flex justify-center gap-2 mt-3 md:hidden">
          <span class="text-text-dim text-sm">Swipe to explore</span>
          <svg class="w-5 h-5 text-text-dim animate-bounce-x" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </div>

        <!-- Desktop hint -->
        <div class="hidden md:flex justify-center gap-2 mt-3">
          <span class="text-text-dim text-sm">Drag or use arrows to explore</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Grid -->
  <section class="py-16 md:py-20">
    <div class="max-w-6xl mx-auto px-6">
      <div class="text-center mb-12">
        <h2 class="font-display font-bold text-3xl md:text-4xl text-text mb-4">
          Everything You Need
        </h2>
        <p class="text-text-muted text-lg max-w-2xl mx-auto">
          From setlist management to deep MIDI control, Stage Companion gives you the tools you need.
        </p>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {features.map((feature, i) => (
          <FeatureCard {...feature} delay={i * 100} />
        ))}
      </div>

      <div class="text-center mt-10">
        <a
          href="/features"
          class="inline-flex items-center gap-2 px-6 py-3 text-primary hover:text-primary-hover font-medium transition-colors"
        >
          See all features
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Deep MIDI Control Section -->
  <section class="py-16 md:py-24 bg-surface/30">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
        <!-- Screenshots side by side -->
        <div class="relative flex justify-center items-end gap-4 lg:gap-6">
          <!-- Glow -->
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[400px] h-[400px] bg-primary/10 rounded-full blur-[100px]"></div>

          <!-- Organ drawbars -->
          <div class="relative -rotate-3 translate-y-4">
            <PhoneMockup src="/screenshots/controls-organ.png" alt="Organ drawbars" size="sm" />
          </div>

          <!-- Synth controls -->
          <div class="relative rotate-2 -translate-y-4 z-10">
            <PhoneMockup src="/screenshots/controls-synth.png" alt="Synth filter controls" size="sm" />
          </div>
        </div>

        <!-- Content -->
        <div>
          <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full mb-6">
            <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
            </svg>
            <span class="text-primary text-sm font-medium">Extended Controls</span>
          </div>

          <h2 class="font-display font-bold text-3xl md:text-4xl lg:text-5xl text-text mb-6">
            Deep MIDI Control
          </h2>
          <p class="text-text-muted text-lg leading-relaxed mb-8">
            Access controls that aren't available from the keyboard itself. Adjust organ drawbars with presets, tweak synth filter parameters with an XY pad, and control effects in real-time.
          </p>

          <div class="grid sm:grid-cols-2 gap-4">
            {[
              { icon: 'ðŸŽ¹', label: '9-Fader Drawbars', desc: 'With Gospel, Jazz & Full presets' },
              { icon: 'ðŸŽ›ï¸', label: 'Filter XY Pad', desc: 'Freq & Resonance control' },
              { icon: 'ðŸ”Š', label: 'Rotary Speed', desc: 'Slow/Fast with visual feedback' },
              { icon: 'âš¡', label: 'Section Switches', desc: 'Organ, Piano, Synth toggles' },
              { icon: 'ðŸ“Š', label: 'ADSR Editor', desc: 'Filter envelope shaping' },
              { icon: 'ðŸŽšï¸', label: 'Morph Pad', desc: 'Assignable XY controller' },
            ].map(item => (
              <div class="flex items-start gap-3 p-3 rounded-xl bg-surface/50 border border-border/30">
                <span class="text-xl">{item.icon}</span>
                <div>
                  <div class="font-medium text-text text-sm">{item.label}</div>
                  <div class="text-text-dim text-xs">{item.desc}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stage Ready Section -->
  <section class="py-16 md:py-24">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
        <!-- Content first on desktop -->
        <div class="lg:order-1">
          <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-orange-500/10 rounded-full mb-6">
            <svg class="w-4 h-4 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-orange-400 text-sm font-medium">Stay in Time</span>
          </div>

          <h2 class="font-display font-bold text-3xl md:text-4xl lg:text-5xl text-text mb-6">
            Perfect Timing, Every Gig
          </h2>
          <p class="text-text-muted text-lg leading-relaxed mb-8">
            The integrated metronome starts automatically with each song. Set BPM per song, choose your time signature, and send MIDI clock to sync arpeggiators and delays.
          </p>

          <ul class="space-y-4">
            {[
              'Auto-start metronome when navigating songs',
              '24 PPQN MIDI clock for perfect arpeggiator sync',
              '7 time signatures from 2/4 to 8/4',
              'Quarter, eighth, and sixteenth subdivisions',
              'Audio click with adjustable latency offset',
            ].map(item => (
              <li class="flex items-center gap-3 text-text-muted">
                <svg class="w-5 h-5 text-orange-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {item}
              </li>
            ))}
          </ul>
        </div>

        <!-- Screenshot -->
        <div class="lg:order-2 flex justify-center">
          <div class="relative">
            <!-- Glow -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[400px] bg-orange-500/15 rounded-full blur-[80px]"></div>
            <PhoneMockup src="/screenshots/tempo-metronome.png" alt="Tempo and metronome" size="lg" />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 md:py-20">
    <div class="max-w-6xl mx-auto px-6">
      <div class="relative rounded-3xl bg-gradient-to-br from-primary/20 via-surface to-surface border border-primary/20 p-8 md:p-12 text-center overflow-hidden">
        <!-- Decorative -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-primary/5 rounded-full blur-2xl"></div>

        <h2 class="font-display font-bold text-3xl md:text-4xl text-text mb-4 relative">
          Ready to Upgrade Your Performance?
        </h2>
        <p class="text-text-muted text-lg mb-8 max-w-xl mx-auto relative">
          Download Stage Companion and take control of your keyboard like never before.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center relative">
          <a
            href="https://apps.apple.com"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center gap-3 px-8 py-4 bg-primary hover:bg-primary-hover text-white font-semibold rounded-xl transition-all duration-300 hover:scale-105"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
            </svg>
            Download for iOS
          </a>
          <a
            href="/guide"
            class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-surface hover:bg-surface-hover text-text font-semibold rounded-xl border border-border transition-colors"
          >
            Read the Guide
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .font-display {
    font-family: 'Outfit', sans-serif;
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  @keyframes bounceX {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
  }

  .animate-bounce-x {
    animation: bounceX 1.5s ease-in-out infinite;
  }

  .carousel-dot.active {
    background-color: #c8102e;
    transform: scale(1.5);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.getElementById('screenshot-carousel');
    const prevBtn = document.getElementById('carousel-prev');
    const nextBtn = document.getElementById('carousel-next');
    const dots = document.querySelectorAll('.carousel-dot');
    const items = document.querySelectorAll('.carousel-item');

    if (!carousel || !prevBtn || !nextBtn) return;

    let currentIndex = 0;
    const totalItems = items.length;

    // Update active dot
    function updateDots() {
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentIndex);
      });
    }

    // Scroll to specific item
    function scrollToItem(index) {
      const item = items[index];
      if (item) {
        const containerRect = carousel.getBoundingClientRect();
        const itemRect = item.getBoundingClientRect();
        const scrollLeft = carousel.scrollLeft + (itemRect.left - containerRect.left) - (containerRect.width / 2) + (itemRect.width / 2);
        carousel.scrollTo({ left: scrollLeft, behavior: 'smooth' });
        currentIndex = index;
        updateDots();
      }
    }

    // Arrow navigation
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + totalItems) % totalItems;
      scrollToItem(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % totalItems;
      scrollToItem(currentIndex);
    });

    // Dot navigation
    dots.forEach((dot, i) => {
      dot.addEventListener('click', () => {
        scrollToItem(i);
      });
    });

    // Update dots on scroll
    let scrollTimeout;
    carousel.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const containerRect = carousel.getBoundingClientRect();
        const containerCenter = containerRect.left + containerRect.width / 2;

        let closestIndex = 0;
        let closestDistance = Infinity;

        items.forEach((item, i) => {
          const itemRect = item.getBoundingClientRect();
          const itemCenter = itemRect.left + itemRect.width / 2;
          const distance = Math.abs(containerCenter - itemCenter);

          if (distance < closestDistance) {
            closestDistance = distance;
            closestIndex = i;
          }
        });

        currentIndex = closestIndex;
        updateDots();
      }, 50);
    });

    // Drag to scroll (desktop)
    let isDown = false;
    let startX;
    let scrollLeft;

    carousel.addEventListener('mousedown', (e) => {
      isDown = true;
      carousel.classList.add('active');
      startX = e.pageX - carousel.offsetLeft;
      scrollLeft = carousel.scrollLeft;
    });

    carousel.addEventListener('mouseleave', () => {
      isDown = false;
      carousel.classList.remove('active');
    });

    carousel.addEventListener('mouseup', () => {
      isDown = false;
      carousel.classList.remove('active');
    });

    carousel.addEventListener('mousemove', (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - carousel.offsetLeft;
      const walk = (x - startX) * 2;
      carousel.scrollLeft = scrollLeft - walk;
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Only when carousel is in view
      const rect = carousel.getBoundingClientRect();
      const inView = rect.top < window.innerHeight && rect.bottom > 0;

      if (inView) {
        if (e.key === 'ArrowLeft') {
          currentIndex = (currentIndex - 1 + totalItems) % totalItems;
          scrollToItem(currentIndex);
        } else if (e.key === 'ArrowRight') {
          currentIndex = (currentIndex + 1) % totalItems;
          scrollToItem(currentIndex);
        }
      }
    });

    // Initialize first dot
    updateDots();
  });
</script>
